; -*- mode: lisp -*-

(in-package :stumpwm)

(stumpwm:set-prefix-key (stumpwm:kbd "C-i"))
;(stumpwm:set-prefix-key (stumpwm:kbd "C-q")) ; in Emacs this is quoted-insert; in other apps this might be quit, but mostly I won't be using it a bunch. 

;; Key bindings
; Note: use *root-map* to use the prefix key, where C-x becomes C-tC-x
;       use *top-map* to do without it, where C-x is C-x

;(define-key *root-map* (kbd "C-s") "exec open /Applications/Spaces.app")
;(define-key *top-map* (kbd "M-h") 
;  "exec osascript ~/doc/dhd/opt/ascript/x11-hide.ascript")
;(define-key *top-map* (kbd "M-TAB") 
;  "exec osascript ~/doc/dhd/opt/ascript/x11-cmd-tab.ascript")
;(define-key *top-map* (kbd "C-M-SPC")
;  "exec osascript ~/doc/dhd/opt/ascript/switch-lang-input.ascript")


(defcommand paste-x-selection () (:rest)
  "Universal rat-less X paste."
  (let ((cmd (concatenate 'string "insert " (get-x-selection))))
    (eval-command cmd)))
(define-key *root-map* (kbd "y") "paste-x-selection")


(setf stumpwm:*screen-mode-line-format*
      (list "%w | "
            '(:eval (stumpwm:run-shell-command "date" t))))

;; turn on the modeline
(if (not (head-mode-line (current-head)))
    (toggle-mode-line (current-screen) (current-head)))
    ; A head is a physical monitor. A screen is a section of video memory
    ; that heads are mapped on to. When using xinerama you generally have
    ; 1 screen and many heads. When not using xinerama each screen is a
    ; physical monitor so you have many screens with only one head on them.

; default has "c" opening "console", but fuck x-terminal-emulator and I need "c" for conkeror anyway, so fffffffff.

(stumpwm:define-key stumpwm:*root-map* (stumpwm:kbd "x") "exec xterm")
(stumpwm:define-key stumpwm:*root-map* (stumpwm:kbd "C-x") "exec xterm")

(defcommand conkeror () () (run-or-raise "conkeror" '(:class "Conkeror")))(
define-key *root-map* (kbd "c") "conkeror")
(define-key *root-map* (kbd "C-c") "conkeror")
(stumpwm:define-key stumpwm:*root-map* (stumpwm:kbd "C") "exec conkeror -f unfocus") ; run this when Flash or Java applets steal focus and you can't get it back.

(stumpwm:define-key stumpwm:*root-map* (stumpwm:kbd "l") "exec xscreensaver-command -lock")
